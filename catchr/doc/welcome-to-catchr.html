<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Zachary Burchill" />

<meta name="date" content="2020-01-08" />

<title>Getting started with catchr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting started with catchr</h1>
<h4 class="author">Zachary Burchill</h4>
<h4 class="date">2020-01-08</h4>



<p>Compared to many other programming languages, the way <code>R</code> handles “conditions”—errors, warnings, messages, and most things referred to as “exceptions” in other languages—is pretty unintuitive.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> R’s help file on the subject is basically impenetrable,<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> and even though Hadley Wickham has stepped in and produced <a href="http://adv-r.had.co.nz/beyond-exception-handling.html">a very helpful guide on conditions</a>, understanding what’s going on is still pretty hard, and actually <em>handling</em> conditions is even harder.</p>
<p>At its heart, catchr is designed to <del>make it so that you never have to read any of that stuff</del> make dealing with conditions easy from the get-go.</p>
<div id="the-ol-razzle-dazzle" class="section level2">
<h2>The ol’ razzle-dazzle</h2>
<p>Let’s hit you with some imaginary scenarios here, before we get down to the nitty-gritty.</p>
<p>Suppose I want to run some code, and I want to catch any warnings it produces, “hide” them so they don’t appear, and instead just store them so I can do something else with them later on. All without making my code halt or start over.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(catchr)</a>
<a class="sourceLine" id="cb1-2" title="2">results &lt;-<span class="st"> </span><span class="kw">catch_expr</span>(<span class="kw">arbitrary_code</span>(), <span class="dt">warning =</span> <span class="kw">c</span>(collect, muffle))</a></code></pre></div>
<p>Boom, done.</p>
<p>But if I’m going to need to do that a lot, and I’m good programmer who doesn’t want to retype the same code over and over again, I can make a <em>function</em> that can catch conditions the same way for any expression.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">collect_warnings &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(<span class="dt">warning =</span> <span class="kw">c</span>(collect, muffle))</a></code></pre></div>
<p>One line. Look at my nice, portable function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">same_results &lt;-<span class="st"> </span><span class="kw">collect_warnings</span>(<span class="kw">arbitrary_code</span>())</a></code></pre></div>
<p>But let’s say <del>I’m a <em>naaaaasty</em> boy</del><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> I have a complex situation which necessitates printing something when the code raises a message and immediately exiting it, but also turning any warnings into messages, and preventing any errors from crashing everything else. <em>*Shiver*</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">weirdo_catcher &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(</a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="dt">message =</span> <span class="kw">c</span>(<span class="cf">function</span>(x) <span class="kw">print</span>(<span class="st">&quot;oops&quot;</span>), exit),</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">warning =</span> <span class="kw">c</span>(tomessage, muffle),</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">error =</span> muffle)</a></code></pre></div>
<p>I can do that too, and that’s only <em>beginning</em> to scratch the surface of catchr. Although most of the detailed information can be found in the help files and manual, let’s go over some of the basics.</p>
</div>
<div id="catching-conditions-with-plans" class="section level2">
<h2>Catching conditions with “plans”</h2>
<p>Let’s take a look at some of the code we saw before:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">results &lt;-<span class="st"> </span><span class="kw">catch_expr</span>(<span class="kw">arbitrary_code</span>(), <span class="dt">warning =</span> <span class="kw">c</span>(collect, muffle))</a></code></pre></div>
<p>This is pretty quintessential of the catchr system. You have the expression you want to evaluate and catch conditions for (here, <code>arbitrary_code()</code>), followed by the names of the types of conditions you want to catch and the plans you have for them when they’re caught (<code>warning = c(collect, muffle)</code>).</p>
<p>In catchr, users use functions like building blocks to a “plan” of what to do for particular conditions. Users can specify their own functions or use catchr functions, but <code>catcher</code> also offers a useful toolbox of behaviors that work their magic behind the scene through catchr’s simple <a href="http://adv-r.had.co.nz/dsl.html">domain-specific language</a>.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<p>A catchr “plan” starts off as a named argument, where its name is the type of condition it will apply to (e.g., “message”, “warning”, “error”, etc.), and its value will eventually become a function that will take in the condition and do stuff with it. catchr’s “secret sauce” lets you pass in each plan as a list of functions that will be applied to the condition in order.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>But catchr also comes full of stock functions that make condition handling simple—these special functions can be inputted as strings, but catchr promotes more-readable code and saves you extra typing by letting you enter them as unquoted special terms, like <code>collect</code> and <code>muffle</code> in the example above.</p>
<div id="special-reserved-terms" class="section level3">
<h3>Special reserved terms</h3>
<p>These special terms cover some of the most common behaviors users might want to use:</p>
<table>
<colgroup>
<col width="27%"></col>
<col width="72%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Special “reserved” term</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tomessage</code>, <code>towarning</code>, <code>toerror</code></td>
<td>convert conditions to other types of conditions</td>
</tr>
<tr class="even">
<td><code>beep</code></td>
<td>plays a short sound</td>
</tr>
<tr class="odd">
<td><code>display</code></td>
<td>displays the contents of the condition on-screen</td>
</tr>
<tr class="even">
<td><code>collect</code></td>
<td>collects the condition and saves it to a list that will be returned at the end</td>
</tr>
<tr class="odd">
<td><code>muffle</code></td>
<td>“muffles”,<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> a condition so it doesn’t keep going up, and restarts the code</td>
</tr>
<tr class="even">
<td><code>exit</code></td>
<td>immediately stops the code and muffles the condition</td>
</tr>
<tr class="odd">
<td><code>raise</code></td>
<td>raises conditions past <code>exit</code></td>
</tr>
</tbody>
</table>
<p>These can be used as building blocks just like normal functions. For example, in the previous example, we saw how <code>collect</code> and <code>muffle</code> were strung together to make a plan.</p>
</div>
</div>
<div id="even-less-typing" class="section level2">
<h2>Even <em>less</em> typing</h2>
<p>Is typing out plans multiple times <em>still</em> too much typing? Well, catchr lets you save even <em>more</em> space by giving you the option of passing in <em>unnamed</em> arguments into plans!</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">print</span>(<span class="kw">get_default_plan</span>())</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; [1] &quot;collect&quot;</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; [1] &quot;muffle&quot;</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">my_plans &lt;-<span class="st"> </span><span class="kw">make_plans</span>(warning, message, error)</a></code></pre></div>
<p>These unnamed arguments can be entered as either strings or unquoted terms, and should correspond to the name of a condition you want to catch. They will automatically be given whatever catchr’s default plan is, which can be get/set via <code>get_default_plan()</code> and <code>set_default_plan</code>, respectively. Named and unnamed arguments can be mixed freely. Other default behaviors can be get/set with <code>catchr_default_opts()</code>.</p>
</div>
<div id="collecting-conditions" class="section level2">
<h2>“Collecting” conditions</h2>
<p>As you might have noticed, many of the previous examples use a special term, <code>collect</code>. Having the ability to “collect” conditions is one of the most useful features in catchr.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">throw_a_fit &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="kw">message</span>(<span class="st">&quot;This is message #1!&quot;</span>)</a>
<a class="sourceLine" id="cb7-3" title="3">  rlang<span class="op">::</span><span class="kw">warn</span>(<span class="st">&quot;This is warning #1!&quot;</span>, <span class="dt">opt_val =</span> <span class="st">&quot;conditions can hold more data&quot;</span>)</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="kw">message</span>(<span class="st">&quot;This is message #2&quot;</span>)</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="kw">stop</span>(<span class="st">&quot;Code exits after this!&quot;</span>)</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">warning</span>(<span class="st">&quot;This warning won&#39;t be reached&quot;</span>)</a>
<a class="sourceLine" id="cb7-7" title="7">}</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">collected_results &lt;-<span class="st"> </span><span class="kw">catch_expr</span>(<span class="kw">throw_a_fit</span>(), message, warning, error)</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="kw">print</span>(collected_results)</a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; $value</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; $message</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; $message[[1]]</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; &lt;simpleMessage in message(&quot;This is message #1!&quot;): This is message #1!</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; $message[[2]]</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt; &lt;simpleMessage in message(&quot;This is message #2&quot;): This is message #2</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt; &gt;</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt; $warning</span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt; $warning[[1]]</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt; &lt;warning: This is warning #1!&gt;</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">#&gt; $error</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co">#&gt; $error[[1]]</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="co">#&gt; &lt;simpleError in throw_a_fit(): Code exits after this!&gt;</span></a></code></pre></div>
<p>This is particularly useful if you want to catch warnings and messages, etc. from code that takes a long time to run, where having to restart the whole process from square one would be too costly.</p>
<p>Or if you want to collect warnings, messages, and errors from code that is running remotely, where these conditions would not be returned with the rest of the results, such as with the <a href="https://github.com/HenrikBengtsson/future/">future package</a>. The following isn’t a very… <em>natural</em> example, but I’m trying to keep things simple:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">library</span>(future)</a>
<a class="sourceLine" id="cb8-2" title="2">future<span class="op">::</span><span class="kw">plan</span>(multiprocess)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">possible_scenarios &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="kw">quote</span>(<span class="kw">warning</span>(<span class="st">&quot;Model failed to converge!&quot;</span>)),</a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="kw">quote</span>(<span class="kw">message</span>(<span class="st">&quot;Singular fit!&quot;</span>)),</a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="kw">quote</span>(<span class="kw">stop</span>(<span class="st">&quot;You couldn&#39;t something wrong&quot;</span>)),</a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="kw">quote</span>(<span class="st">&quot;Everything is good!&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" title="9">)</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11">collector &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(message, warning, error,</a>
<a class="sourceLine" id="cb8-12" title="12">                           <span class="dt">.opts =</span> <span class="kw">catchr_opts</span>(<span class="dt">default_plan =</span> <span class="kw">c</span>(collect, muffle)))</a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14">l <span class="op">%&lt;-%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="co"># You should use `purrr::map` instead, it&#39;s much better</span></a>
<a class="sourceLine" id="cb8-16" title="16">  <span class="kw">Map</span>(<span class="cf">function</span>(x) <span class="kw">collector</span>(<span class="kw">eval</span>(x)), possible_scenarios)</a>
<a class="sourceLine" id="cb8-17" title="17">}</a>
<a class="sourceLine" id="cb8-18" title="18"></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co"># Eh, let&#39;s get rid of anything that had an error?</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="kw">Filter</span>(<span class="cf">function</span>(e) <span class="kw">length</span>(e<span class="op">$</span>error) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, l)</a></code></pre></div>
<p><em>OR</em>, maybe you’re running a lot of code in parallel and want to keep track of all of the raised conditions in R (where they’re easiest to manipulate), such as in a large-scale power simulation, or with packages such <a href="https://github.com/tidyverse/purrr">purrr</a>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Let&#39;s combine both `future` and `purrr` with Davis Vaughan&#39;s `furrr` package instead</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">library</span>(furrr)</a>
<a class="sourceLine" id="cb9-3" title="3">future<span class="op">::</span><span class="kw">plan</span>(<span class="kw">tweak</span>(multiprocess, <span class="dt">workers =</span> 5L))</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co"># Sexy data frame format for easy analysis!</span></a>
<a class="sourceLine" id="cb9-6" title="6">df &lt;-<span class="st"> </span><span class="kw">future_imap_dfr</span>(</a>
<a class="sourceLine" id="cb9-7" title="7">  possible_scenarios,</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="cf">function</span>(x, i) {</a>
<a class="sourceLine" id="cb9-9" title="9">    res &lt;-<span class="st"> </span><span class="kw">collector</span>(<span class="kw">eval</span>(x))</a>
<a class="sourceLine" id="cb9-10" title="10">    <span class="kw">data.frame</span>(<span class="dt">k =</span> i,</a>
<a class="sourceLine" id="cb9-11" title="11">               <span class="dt">messages =</span> <span class="kw">paste</span>(res<span class="op">$</span>message, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>),</a>
<a class="sourceLine" id="cb9-12" title="12">               <span class="dt">warnings =</span> <span class="kw">paste</span>(res<span class="op">$</span>warning, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>),</a>
<a class="sourceLine" id="cb9-13" title="13">               <span class="dt">errors =</span>   <span class="kw">paste</span>(res<span class="op">$</span>error, <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>),</a>
<a class="sourceLine" id="cb9-14" title="14">               <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb9-15" title="15">  })</a></code></pre></div>
</div>
<div id="other-goodies" class="section level2">
<h2>Other goodies</h2>
<p>catchr offers many other benefits, to the point where trying to document them all in a single vignette doesn’t make sense. I’ll point out some of the more unique ones here, but the help docs are very extensive, so give them a try!</p>
<div id="catching-misc-conditions" class="section level3">
<h3>Catching “misc” conditions</h3>
<p>Sometimes we don’t want to have to specify every alternative condition out there, and we might just want to divide conditions into one type and “everything else”.</p>
<p>You can do this by making plans for the “misc” condition, a term catchr reserves for any condition(s) that you haven’t already specified. Thus:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">messages_or_bust &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(<span class="dt">messages =</span> collect, <span class="dt">misc =</span> <span class="kw">exit_with</span>(<span class="st">&quot;Sorry, busted&quot;</span>))</a></code></pre></div>
<p>will collect messages (without muffling them) but will exit the evaluation and return a conciliatory if any other types of conditions are raised. Note that using the all-purpose “condition” plan (i.e., <code>condition = exit_with(&quot;Sorry, busted&quot;)</code>) would exit when a message is raised, since it isn’t muffled and qualifies as having the type “condition”. Using “misc” makes sure you don’t “double-dip” conditions.</p>
<p>The “misc” condition is particularly useful when collecting conditions—it lets you lump all the miscellaneous conditions collected into a single “misc” sublist. Since anything other than the “big three” conditions (errors, messages, and warnings) are so rare, the following makes a nice little collector that lumps anything “exotic” into the “misc” sublist and drops any condition sublist when that condition isn’t raised:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">basic_collector &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  message, warning, error, misc,</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="dt">.opts =</span> <span class="kw">catchr_opts</span>(<span class="dt">default_plan =</span> <span class="kw">c</span>(collect, muffle),</a>
<a class="sourceLine" id="cb11-4" title="4">                      <span class="dt">drop_empty_conds =</span> T))</a></code></pre></div>
</div>
<div id="display-conditions-in-style" class="section level3">
<h3>Display conditions <em>in style</em></h3>
<p>If you have the <code>crayon</code> package installed, you can display messages without raising them in whatever <code>crayon</code> stylings you want (though you won’t see the styles in this vignette document):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">make_warnings &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">warning</span>(<span class="st">&quot;This warning has a call&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">warning</span>(<span class="st">&quot;This warning does not&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="kw">invisible</span>(<span class="st">&quot;done&quot;</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">}</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">catch_expr</span>(<span class="kw">make_warnings</span>(), <span class="dt">warning =</span> <span class="kw">c</span>(display, muffle))</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; warning in `make_warnings()`: This warning has a call</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; warning: This warning does not</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; [1] &quot;done&quot;</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="kw">catch_expr</span>(<span class="kw">make_warnings</span>(), <span class="dt">warning =</span> <span class="kw">c</span>(<span class="kw">display_with</span>(<span class="kw">c</span>(<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;underline&quot;</span>,<span class="st">&quot;bold&quot;</span>)), muffle))</a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; simpleWarning in `make_warnings()`: This warning has a call</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; simpleWarning: This warning does not</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; [1] &quot;done&quot;</span></a></code></pre></div>
</div>
<div id="play-sounds-when-conditions-are-raised" class="section level3">
<h3>Play sounds when conditions are raised</h3>
<p>Particularly useful for when you’re working in a different window and waiting for a job to finish / do something unexpected, catchr lets you play short sounds whenever conditions are raised.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> This functionality requires the <a href="https://CRAN.R-project.org/package=beepr"><code>beepr</code></a> package, which I’ve found absolutely worth downloading.</p>
<p>For example, you can have it alert you when a condition is raised via sound, display the condition without raising it, and keep going:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">warning_in_middle &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw">message</span>(<span class="st">&quot;It&#39;s time!&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="kw">invisible</span>(<span class="st">&quot;done&quot;</span>)</a>
<a class="sourceLine" id="cb13-6" title="6">}</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">res &lt;-<span class="st"> </span><span class="kw">catch_expr</span>(<span class="kw">warning_in_middle</span>(), <span class="dt">condition =</span> <span class="kw">c</span>(beep, display, muffle))</a></code></pre></div>
<p>Or you could imagine making a wrapper that screams and stop evaluation whenever it encounters <em>any</em> unexpected condition:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">tell_you_when_it_blows_up &lt;-<span class="st"> </span><span class="kw">make_catch_fn</span>(<span class="dt">condition =</span> <span class="kw">c</span>(display, <span class="kw">beep_with</span>(<span class="dv">9</span>), exit))</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">tell_you_when_it_blows_up</span>(<span class="kw">message</span>(<span class="st">&quot;Oopsies!&quot;</span>))</a></code></pre></div>
</div>
<div id="all-plans-are-calling-handlers" class="section level3">
<h3>All plans are “calling handlers”</h3>
<p>This is definitely more of a technical point, but all the plans in catchr are technically evaluated in order. Currently (<code>rlang 0.3.1</code>) <code>rlang</code>’s condition-handling function, <code>with_handlers</code>, has the relatively unintuitive property of not checking its handlers in the order they are defined, but first checking all the “exiting” handlers, and then checking all the “calling” handlers. catchr’s main condition handling does better: it gets rid of “exiting” handlers all together.</p>
<p>Ok, this is beginning to get <em>much</em> more technical, but there are many other benefits to making all the plans (and therefore, handlers) “calling” handlers. For one, any plan has the option of restarting the code (via <code>muffle</code>, or invoking user-created restarts).</p>
<p>But each plan can also act as an “exiting” handler with the use of the <code>exit</code> term, or the <code>user_exit()</code> and <code>exit_with()</code> functions. In essence, catchr gives you the best of both worlds!</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>At least, I <em>thought</em> it was. Now I understand that it’s everything <em>else</em> that doesn’t make sense.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Accessible via <code>help(conditions)</code>.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Ed.: you can’t say that in a CRAN package<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>See <code>help(&quot;catchr-DSL&quot;, &quot;catchr&quot;)</code> for the details.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>See <code>help(`catchr-plans`, &quot;catchr&quot;)</code>.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>i.e., “suppresses”, “catches”, “hides”—whatever you want to call it<a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>If you’re going to be doing something like this, make sure <code>getOption(&quot;warn&quot;)==1</code><a href="#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
